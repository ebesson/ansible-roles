---
sudo: required
dist: xenial
language: python
python:
  - 3.6
cache:
  pip: true
before_install:
  - sudo apt-get -qq update && sudo apt remove --purge lxd lxd-client
  - sudo rm -Rf /var/lib/lxd
  - sudo apt-get -y install snapd
  - sudo snap install lxd
  - sudo systemctl stop snap.lxd.daemon.service
  - sudo rm -Rf /var/snap/lxd/common/lxd/*
  - sudo systemctl start snap.lxd.daemon.service
  - sudo bash -c 'echo PATH=/snap/bin:$PATH >> /etc/environment'
  - while [ ! -S /var/snap/lxd/common/lxd/unix.socket ]; do echo "Waiting for LXD socket...";sleep 0.2;done;
  - sudo lxd init --auto
  - sudo mkdir -p /var/lib/lxd
  - sudo ln -s /var/snap/lxd/common/lxd/unix.socket /var/lib/lxd/unix.socket
script:
  - sudo tox -e ci
